:topic_type: task

[.task]
== Connect AWS CodeCommit

Integrate Prisma Cloud with your AWS CodeCommit version control system (VCS) to gain visibility into, and monitor the systems, technologies, configurations, and pipelines that make up the AWS CodeCommit platform.
This integration enables security scans to identify Infrastructure-as-Code (IaC) misconfigurations, Software Composition Analysis (SCA) vulnerabilities, exposed secrets, license mis-compliance and CI/CD pipeline risks in your AWS CodeCommit, allowing you to understand and fix issues as soon as they are detected, resulting in an enhanced security posture for your organization.

===  Authorization Process Overview

During integration, Prisma Cloud provides you with a CloudFormation (CFN) template for deploying your AWS account. Once deployed, the CFN template will establish the following components in your environment:

* An IAM role configured with access to AWS CodeCommit
* An SNS topic with an HTTP subscription to the Prisma Cloud webhook URL

Subsequently, every CloudFormation event occurring in your account will trigger an SNS event sent to the Prisma Cloud AWS account, including 'Creation', 'Update' and 'Deletion'.

image::application-security/aws-event-overview.png[]

[.procedure]

. Before you begin.
.. Grant the Prisma Cloud user the necessary permissions for integrating Prisma Cloud with your AWS CodeCommit VCS, as specified in <<#user-permissions, User Permissions>> below.

.. Add the Prisma Cloud IP addresses and hostname for Application Security to an xref:../../../../get-started/console-prerequisites.adoc[allow list] to enable access to the Prisma Cloud Console.

..  Due to CloudFormation's constraints, Simple Notification Service (SNS) events for creations, deletions and so on need to reside in the same region as the stack. To accommodate situations where a customer's Prisma Cloud account and stack are in different regions, an SNS topic must be generated for each accessible region.
+
NOTE: In the context of AWS, a 'stack' refers to a collection of AWS resources that are created, updated, and deleted together as a single unit. This allows for the management of related resources as a cohesive unit, making it easier to provision and manage complex infrastructure deployments.

. . On the Prisma Cloud *Application Security* console.
.. Select *Settings* > *Connect Provider* > *Code & Build Providers*.
+
image::application-security/connect-provider-menu.png[]

.. Select *AWS CodeCommit* (under Code Repositories) in the catalog that is displayed.
+
image::application-security/aws-catalog2.0.png[]
+
The *Integrate AWS CodeCommit* step of the integration wizard is displayed.
+
image::application-security/aws-int-wizard-step1-2.0.png[]

. On the *AWS* console.

.. Open CloudFormation or copy *xref:[this link to be provided]* and send it to your administrator.

.. Provide the stack name.
+
NOTE: The following fields are pre-populated:
* *Resource Name Prefix*. You can modify this default value
* *ExternalID*: DO NOT change this ID
+
The stack is created. 

//TODO - check if you have to click a button to create etc)

. Verify integration. 
.. In *Application Security*, select *Home* > *Settings* > *Code & Build Providers* > *AWS CodeCommit*.
.. Confirm that the integration is displayed.
+
image::application-security/[]
// this is the current aws-integration-list1.0.png
// NOTE: It may take up to 3 minutes for the integration status to be updated.

. Select the repositories to be scanned.

.. Click *Select repositories* in the integration's *Actions* column.
+
The *Add Repositories* step of the integration wizard is displayed. 
image::application-security/[]
// this is the current aws-int-wizard-repos1.0.png

.. Select which repositories will be scanned: 
+
* *Permit all existing repositories* 
* *Permit all existing and future repositories*.  This is the recommended option to ensure complete coverage and successful operation of all features. 
* *Choose from repository list* > Select repositories


. Select *Done* to complete the integration.

. Next step: Monitor and manage scan results.
+
* View your selected AWS CodeCommit repositories on the *Repositories* page. The next AWS CodeCommit scan will include these repositories
* To view scan results and resolve issues, in *Application Security* select *Home* > *Projects*. See xref:../../../risk-management/monitor-and-manage-code-build/monitor-and-manage-code-build.adoc[Monitor and Manage Code Build Issues] for more information  

[#multi-integrate]
=== Support for Multiple Integrations

Prisma Cloud supports multiple integrations for multiple AWS CodeCommit accounts. 

Multiple integrations from a single Prisma Cloud account enables you to:

* View a list of integrations on a single console
//* Update existing integrations by modifying the selection of workspaces
* Add additional integrations
* Delete an existing integration

NOTE: Selecting a repository for a specific integration will restrict you from selecting the same repository in another integration.

[.procedure]

. In Application Security, select *Home* > *Settings* > *Connect Provider* > *Code & Build Providers* > *AWS CodeCommit* (under Code Repositories).
. Select *Add Integration* in the wizard.
. Execute the AWS CodeCommit integration process above.
. Next step: Monitor and manage scan results - see above.


=== Manage integrations

You can reselect repositories or delete an integration:
. In *Application Security*, select *Settings* > *Code & Build Providers* > *AWS CodeCommit*. 
+
A list of integrations is displayed

. Select the menu under the Actions column for an integration.
+
image::application-security/aws-manage-int1.0.png[]
. Perform an action:
* *Reselect repositories*: Access and modify the list of repositories to be scanned
* *Delete integration*: Delete an integration

////
* *Manage VCS user tokens*: Enables you to integrate one or more AWS CodeCommit accounts.
+
NOTE: You cannot delete the integration from *Repositories* for an account integration that supports multiple user tokens.
////
[#user-permissions]
=== User Permissions

Authorize the user integrating Prisma Cloud with your AWS CodeCommit instance with the following permissions.

*CodeCommit Permissions*

These permissions pertain to various actions and operations within AWS CodeCommit.

* *codecommit:GitPull*: Allows users to pull Git repository changes
* *codecommit:ListBranches*: Grants the ability to list branches within a repository
* *codecommit:GetBranch*: Permits retrieval of branch details
* *codecommit:GetPullRequest*: Enables fetching details of a specific pull request
* *codecommit:GetFolder*: Allows retrieval of the contents of a folder within a repository, including a list of files and subfolders
* *codecommit:GetFile*: Allows fetching the content of a specific file within a repository
* *codecommit:GetBlob*: Allows fetching of an object (such as a file) from a repository
* *codecommit:GetCommitsFromMergeBase*: Grants access to commits from the merge base of a branch
* *codecommit:GetCommentsForPullRequest*: Allows retrieval of comments associated with a pull request
* *codecommit:PostCommentReply*: Enables posting replies to comments on pull requests
* *codecommit:UpdateComment*: Allows updating of comments on pull requests
* *codecommit:PostCommentForPullRequest*: Allows posting comments on a specific pull request
* *codecommit:GetComment*: Permits retrieval of a specific comment on a pull request
* *codecommit:GetCommit*: Allows fetching details of a specific commit
* *codecommit:GetDifferences*: Grants access to differences (changes) between commits, branches, and so on
* *codecommit:BatchGetRepositories*: Enables batch retrieval of repository details 
* *codecommit:GetRepository*: Permits fetching details of a specific repository 
* *codecommit:ListRepositories*: Grants the ability to list repositories within an account 
* *codecommit:GetRepositoryTriggers*: Allows fetching of triggers configured for a repository 
* *codecommit:PutRepositoryTriggers*: Enables configuration of repository triggers 
* *codecommit:TestRepositoryTriggers*: Allows testing of repository triggers
* *codecommit:GetTree*: Allows retrieval of the structure of a directory, including the current contents of subdirectories
* *codecommit:GetReferences*: Permits fetching of references (branches, tags, etc.) in a repository
* *codecommit:GetObjectIdentifier*: Grants access to object identifiers within a repository
* *codecommit:GetCommitHistory*: Allows fetching of commit history for a repository
* *codecommit:BatchGetPullRequests*: Enables retrieval of details for multiple pull requests in a single API call, improving efficiency for fetching information on a large number of pull requests
* *codecommit:BatchGetCommits*: Enables batch retrieval of commit details
* *codecommit:GetCommentsForComparedCommit*: Allows retrieving comments associated with a specific compared commit in a pull request
* *codecommit:PostCommentsForComparedCommit*: Enables posting comments on a specific compared commit in a pull request
* *codecommit:PostCommentReply*: Enables posting replies to comments on pull requests
* *codecommit:ListPullRequests*: Grants the ability to list all pull requests within a repository
* *codecommit:DeleteCommentContent*: Allows deletion of the content of a comment on a pull request.
* *codecommit:CreateBranch*: Permits creation of branches within a repository
* *codecommit:GetBranch*: Permits retrieval of branch details
* *codecommit:CreateCommit*: Allows creation of commits in a repository
* *codecommit:CreatePullRequest*: Enables creation of pull requests in a repository
* *codecommit:PutFile*:  Allows uploading a file to a specific branch in a CodeCommit repository. It essentially enables adding or updating a file within the repository
* *codecommit:ListAssociatedApprovalRuleTemplatesForRepository*: Grants access to associated approval rule templates for a repository
* *codecommit:ListApprovalRuleTemplates*: Allows listing of approval rule templates
* *codecommit:GetApprovalRuleTemplate*:
* *codecommit:ListRepositoriesForApprovalRuleTemplate*: Permits listing of repositories associated with an approval rule template

*IAM and Organizations Permissions*

These permissions are essential for managing access control, user permissions, and organizational policies within the AWS environment through IAM.

* *iam:ListPolicies*: Allows listing of IAM policies within the AWS account
* *iam:ListGroupPolicies*: Permits listing of group policies attached to IAM groups
* *iam:ListPoliciesGrantingServiceAccess*: Enables listing of policies granting access to specific AWS services
* *organizations:ListPolicies*: Grants access to listing of policies within AWS Organizations
* *organizations:ListDelegatedAdministrators*: Allows listing of delegated administrators within AWS Organizations
* *organizations:ListAccounts*: Permits listing of member accounts within AWS Organizations
* *iam:ListRoles*: Enables listing of IAM roles within the AWS account
* *iam:ListGroupsForUser*: Allows listing of IAM groups that a specified user belongs to
* *iam:ListUsers*: Permits listing of IAM users within the AWS account
* *iam:ListGroups*: Grants access to listing of IAM groups within the AWS account
* *iam:ListRolePolicies*: Allows listing of policies attached to IAM roles
* *iam:GetAccountAuthorizationDetails*: Permits fetching of details related to account authorization within IAM

////
==== CI/CD Module Permissions

For CI/CD module support, a phase that is not mandatory for creating a PAT (Personal Access Token) has been added. This token contains the following permissions relevant to the CI/CD module:
////

////
[#subscribed-events]
=== Subscribed Events

Below is a comprehensive list of events to which Prisma Cloud is subscribed. These events encompass various actions and changes occurring within your AWS CodeCommit environment that trigger notifications and integrations with Prisma Cloud.

* *All repository events*
////